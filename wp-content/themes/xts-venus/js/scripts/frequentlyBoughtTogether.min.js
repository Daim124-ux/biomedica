!function(r){XTSThemeModule.frequentlyBoughtTogether=function(){function d(n){var o={};return n.find(".xts-fbt-product").each(function(){var t=r(this),e=r(this).find("input"),s=t.data("id"),a=n.parents(".xts-fbt");e.length?e.is(":checked")?(t.find(".xts-fbt-product-variation").length?o[s]=t.find(".xts-fbt-product-variation select").val():o[s]="",a.find(".product.post-"+s).removeClass("xts-disabled-fbt")):e.parents(".xts-fbt-form").hasClass("xts-checkbox-uncheck")||a.find(".product.post-"+s).addClass("xts-disabled-fbt"):t.find(".xts-fbt-product-variation").length?o[s]=t.find(".xts-fbt-product-variation select").val():o[s]=""}),o}r("form.xts-fbt-form").each(function(){var o="",i=r(this);i.on("change",".xts-fbt-product input, .xts-fbt-product select",function(){var t=r(this),n=d(i),e=i.find("input[name=xts-fbt-main-product]").val(),s=i.find(".xts-fbt-purchase-btn");n&&void 0!==n[e]&&(Object.keys(n).length<2?s.addClass("xts-disabled"):s.removeClass("xts-disabled"),(e=i.parents(".xts-fbt").find(".xts-carousel")).hasClass("xts-loaded")&&(s=e.find(".swiper-container")[0].swiper,1===(e=t.parents(".xts-fbt-product").index())&&void 0!==s.params.slidesPerView&&1<s.params.slidesPerView&&(e=0),s.slideTo(e,300)),clearTimeout(o),o=setTimeout(function(){var t,e,s,a;e=n,s=(t=i).find("input[name=xts-fbt-main-product]").val(),a=t.find("input[name=xts-fbt-bundle-id]").val(),t.find(".xts-loader-overlay").addClass("xts-loading"),r.ajax({url:xts_settings.ajaxurl,data:{action:"xts_update_frequently_bought_price",products_id:e,main_product:s,bundle_id:a,key:xts_settings.frequently_bought},method:"POST",success:function(t){t.fragments&&r.each(t.fragments,function(t,e){r(t).replaceWith(e)})},error:function(){console.log("ajax error")},complete:function(){t.find(".xts-loader-overlay").removeClass("xts-loading")}})},1e3))}),i.on("click",".xts-fbt-purchase-btn",function(t){t.preventDefault();var e,s,a=r(this);a.hasClass("xts-disabled")||(t=d(i),e=i.find("input[name=xts-fbt-main-product]").val(),s=i.find("input[name=xts-fbt-bundle-id]").val(),t&&void 0!==t[e]&&(clearTimeout(o),a.addClass("loading"),r.ajax({url:xts_settings.ajaxurl,data:{action:"xts_purchasable_fbt_products",products_id:t,main_product:e,bundle_id:s,key:xts_settings.frequently_bought},method:"POST",success:function(t){var e=r(".woocommerce-notices-wrapper");e.empty(),t.notices&&0<t.notices.indexOf("error")?(e.append(t.notices),e=e.offset().top-xts_settings.single_product_sticky_offset,r("html, body").stop().animate({scrollTop:e},400)):void 0!==t.fragments&&("widget"===xts_settings.action_after_add_to_cart&&r.magnificPopup.close(),a.addClass("added"),XTSThemeModule.$body.trigger("added_to_cart",[t.fragments,t.cart_hash,""]))},error:function(){console.log("ajax error")},complete:function(){a.removeClass("loading")}})))})})},r(document).ready(function(){XTSThemeModule.frequentlyBoughtTogether()})}(jQuery);